
### antivirtualization  {.smaller}


* a lot of malware tries to behave different in a VM 
<hr class="vspace" />
* why? 

   * used by antivirus software to handle packers
   * used to analyze malware
   * …



### antivirtualization techniques  {.smaller}


* [query virtual devices]{.fragment fragment-index=23 .custom .myem-only} 

   * solution: mirror devices of some real machine

* [time operations that are slower in VM/emulation]{.fragment fragment-index=45 .custom .myem-only} 

   * solution: virtual clock

* [use operations not supported by VM]{.fragment fragment-index=67 .custom .myem-only}  

   * solution: support everything



### againframe(antivirtIndex)

### virtual devices 


* VirtualBox device drivers?
* VMware-brand ethernet device?
* …


### againframe(antivirtIndex)

### slower operations  {.smaller}


* not-‘‘native’’ VM: 

   * everything is really slow

* otherwise --- trigger ‘‘callbacks’’ to VM implementation: 

   * system calls?
   * allocating and accessing memory?

* … and hope it's reliably slow enough


### againframe(antivirtIndex)

### operations not supported  {.smaller}



* missing instructions kinds? 

   * FPU instructions
   * MMX/SSE instructions
   * undocumented (!) CPU instructions

* not handling OS\\tikzmark{OS} features? 

   * setting up special handlers for segfault
   * multithreading
   * system calls that make callbacks
   * …

 ![](/antianti/texfig/antivm-intro-operations-not-supported.figure.svg){.absolute top="0%" left="0%" width=1050 height=600 .my-center }

