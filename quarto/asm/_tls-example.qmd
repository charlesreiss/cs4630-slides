
### thread-local storage 


* Linux, Windows use %fs, %gs for thread-local storage 
<hr class="vspace" />
* variables that have different values in each thread
* e.g. for program using multiple cores <br> to track different values for each core


### TLS example (read) (C)  {.smaller}


```
#include <threads.h>
thread_local int thread_local_value = 0;
int get_thread_local() {
    return thread_local_value;
}

```
 <hr />
 
```
0000000000001149 <get_thread_local>:
    1149:       f3 0f 1e fa             
                    endbr64 
    114d:       64 8b 04 25 fc ff ff ff
                    mov    %fs:0xfffffffffffffffc,%eax
    1155:       c3  
                    retq   

```
 <hr />
 
```
TLS off    0x0000000000002df0 vaddr 0x0000000000003df0 paddr 0x0000000000003df0 align 2**2
    filesz 0x0000000000000000 memsz 0x0000000000000004 flags r--

```


### TLS example (write) (C)  {.smaller}


```
#include <threads.h>
thread_local int thread_local_value = 0;
void set_thread_local(int new_value) {
    thread_local_value = new_value;
}

```
 <hr />
 
```
0000000000001156 <set_thread_local>:
    1156:       f3 0f 1e fa 
                    endbr64 
    115a:       64 89 3c 25 fc ff ff ff
                    mov    %edi,%fs:0xfffffffffffffffc
    1162:       c3
                    retq

```

