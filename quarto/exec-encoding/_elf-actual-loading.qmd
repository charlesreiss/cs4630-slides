
{{< include /exec-encoding/_myemph-lib.qmd >}}

### ELF loading: pages  {.smaller}


* Linux, most other OSes manage memory/files in <it>pages</it> 

   * hardware feature: virtual memory
   * on x86-64: typically 4096 bytes

* changes how LOADs work: 

   * offset must be rounded to multiple of page size
   * size loaded rounded up to whole number of pages



### ELF loading: pages example  {.smaller}

program header: 
<pre><code>LOAD off    0x0000000 vaddr 0x00400000 paddr 0x00400000 align 2**12
     filesz 0x0000<span data-fragment-index="2" class="fragment custom myem-only">518</span> memsz 0x00000518 flags r--
LOAD off    0x0001000 vaddr 0x00401000 paddr 0x00401000 align 2**12
     filesz 0x00<span data-fragment-index="3" class="fragment custom myem-only">9352d</span> memsz 0x0009352d flags r-x
LOAD off    0x0095000 vaddr 0x00495000 paddr 0x00495000 align 2**12
     filesz 0x00<span data-fragment-index="3" class="fragment custom myem-only">265e5</span> memsz 0x000265e5 flags r--
LOAD off    0x00bc0c0 vaddr 0x004bd0c0 paddr 0x004bd0c0 align 2**12
     filesz 0x000<span data-fragment-index="4" class="fragment custom myem-only">6170</span> memsz 0x000078c0 flags rw-
</code></pre>
 <hr />
 actually loaded (via Linux <code>/proc/PID/maps</code>): 
<pre><code>memory address       size        r/w? file offset
~~~~~~~~~~~~~~~~~ (~~~~~~~~)     ~~~~ ~~~~~~~~ 
00400000-00401000 (  <span data-fragment-index="2" class="fragment custom myem-only">0x1000</span>)     r--p 00000000
00401000-00495000 ( <span data-fragment-index="3" class="fragment custom myem-only">0x94000</span>)     r-xp 00001000
00495000-004bc000 ( <span data-fragment-index="3" class="fragment custom myem-only">0x27000</span>)     r--p 00095000
004bd000-004c0000 (  <span data-fragment-index="4" class="fragment custom myem-only">0x3000</span>)     r--p 000bc000
004c0000-004c4000 (  <span data-fragment-index="4" class="fragment custom myem-only">0x4000</span>)     rw-p 000bf000
</code></pre>

