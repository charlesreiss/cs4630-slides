### hooking 

* hooking --- getting a ‘hook’ to run on (OS) operations 
   * examples: creating new files, modifying executables
* ideal mechanism: OS support
* less ideal mechanism: change library loading
* less ideal mechanism: replace OS handlers
* less ideal mechanism: debugger support

### hooking 

* hooking --- getting a ‘hook’ to run on (OS) operations 
   * examples: creating new files, modifying executables
* ideal mechanism: <em>OS support</em>
* less ideal mechanism: change library loading
* less ideal mechanism: replace OS handlers
* less ideal mechanism: debugger support

###  


![](/heur-detect/filter-driver){}


### Linux hooking

* several possible mechanisms
* tracepoints, kprobes 
   * cause hooking functions to run when kernel functions called or return
   * hooker function can arrange for logging or other action
* seccomp BPF 
   * allow hooker to write ‘program’ to examine system calls of selected processes
   * can deny/change/log those system calls



### aside Linux eBPF 

* eBPF = extended Berkeley Packet Filters
* little programming language originally intended for network filtering


### hooking 

* hooking --- getting a ‘hook’ to run on (OS) operations 
   * examples: creating new files, modifying executables
* ideal mechanism: OS support
* less ideal mechanism: <em>change library loading</em>
* less ideal mechanism: replace OS handlers
* less ideal mechanism: debugger support

### changing library loading 

* e.g. install new library --- or edit loader, but … 
<hr class="vspace" />
* not everything uses library functions
* what if your wrapper doesn't work exactly the same?


### hooking 

* hooking --- getting a ‘hook’ to run on (OS) operations 
   * examples: creating new files, modifying executables
* ideal mechanism: OS support
* less ideal mechanism: change library loading
* less ideal mechanism: <em>replace OS handlers</em>
* less ideal mechanism: debugger support

### changing exception call handlers (1) 

* data structure tells hardware where program requests go
   * typically array with one entry per request type
   * usually set to point to OS routines
* simpliest mechanism: edit that data structure  
   * and save a copy of what was there before
* point to your "hook" code 
   * and call what was there before after behavior check


