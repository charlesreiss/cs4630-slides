\begin{tikzpicture}
\begin{scope}
\tikzset{every node/.style={font=\small,align=left,anchor=north west,inner sep=0mm}}
\node (vars) {
\usebox{\flexExTop}
};
\node (patMacros) at (vars.south west) {
~
};
\node (sepA) at (patMacros.south west) {
\tt  \%\%
};
\node (pats) at (sepA.south west) {
\usebox{\flexExMiddle}
};
\node (sepB) at (pats.south west) {
\tt \%\%
};
\node (mainCode) at (sepB.south west) {
\usebox{\flexExBottom}
};
\end{scope}

\tikzset{
    hi/.style={rounded corners,fill=green,opacity=0.3},
    remark/.style={draw,red,very thick,at={([xshift=-3cm]pats.east)},fill=white,align=left},
    remark2/.style={draw,red,very thick,at={([xshift=-3cm,yshift=2cm]pats.east)},fill=white,align=left},
}

\begin{visibleenv}<2>
    \node[hi,fit=(sepA)] {};
    \node[hi,fit=(sepB)] {};
    \node[remark] {three sections};
\end{visibleenv}

\begin{visibleenv}<3>
    \node[hi,fit=(vars)] {};
    \node[remark] {first --- declarations for later \\
                   C code in output file};
\end{visibleenv}

\begin{visibleenv}<4>
    \node[hi,fit=(pats)] {};
    \node[remark2] {patterns, code to run on match \\
                   as parser: return ``token'' here};
\end{visibleenv}

\begin{visibleenv}<5>
    \node[hi,fit=(mainCode)] {};
    \node[remark] {extra code to include};
\end{visibleenv}

\end{tikzpicture}