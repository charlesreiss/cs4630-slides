\begin{tikzpicture}
\begin{scope}
\tikzset{every node/.style={font=\small,align=left,anchor=north west,inner sep=0mm}}
\node (vars) {
};
\node (patMacros) at (vars.south west) {
\usebox{\flexStatesTop}
};
\node (sepA) at (patMacros.south west) {
\%\%
};
\node (pats) at (sepA.south west) {
\usebox{\flexStatesMiddle}
};
\node (sepB) at (pats.south west) {
\%\%
};
\node (mainCode) at (sepB.south west) {
\usebox{\flexStatesBottom}
};
\end{scope}
\tikzset{
    hi/.style={rounded corners,fill=green,opacity=0.3},
    remark/.style={draw,red,very thick,at={([xshift=-5cm,yshift=-2cm]pats.east)},fill=white,align=left},
}
\begin{visibleenv}<2>
    \node[hi,fit=(patMacros)] {};
    \node[remark] {
        declare ``state'' to track \\
        which state determines what patterns are active \\
        \only<3->{``x'' --- exclusive}
    };
\end{visibleenv}
\end{tikzpicture}