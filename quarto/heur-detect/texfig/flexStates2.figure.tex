\documentclass[tikz]{standalone}
\input{common/tikzBase}
\usetikzlibrary{}
\newsavebox\flexStatesTop
\newsavebox\flexStatesMiddle
\newsavebox\flexStatesBottom
\begin{document}
\begin{lrbox}{\flexStatesTop}
\begin{lstlisting}
%x str
\end{lstlisting}
\end{lrbox}
\begin{lrbox}{\flexStatesMiddle}
\begin{lstlisting}
\"          { BEGIN(str); }
<str>\"     { BEGIN(INITIAL); }
<str>foo    { printf("foo in string\n"); }
foo         { printf("foo out of string\n"); }
<INITIAL,str>(.|\n) {}
\end{lstlisting}
\end{lrbox}
\begin{lrbox}{\flexStatesBottom}
\begin{lstlisting}
int main(void) {
    yylex();
}
\end{lstlisting}
\end{lrbox}
\begin{lrbox}{\flexStatesTop}
\begin{lstlisting}
%s afterFoo
\end{lstlisting}
\end{lrbox}
\begin{lrbox}{\flexStatesMiddle}
\begin{lstlisting}
<afterFoo>foo    { printf("later foo\n"); }
foo              {
                   printf("first foo\n"); 
                   BEGIN(afterfoo);
                 }
(.|\n)  {}  
\end{lstlisting}
\end{lrbox}
\begin{lrbox}{\flexStatesBottom}
\begin{lstlisting}
int main(void) {
    yylex();
}
\end{lstlisting}
\end{lrbox}

\setSlide{1}
\input{heur-detect/texfig/flexStates2.inner.tex}
\setSlide{2}
\input{heur-detect/texfig/flexStates2.inner.tex}
\end{document}
