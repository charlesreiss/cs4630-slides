
### C++ inheritence

```cpp
class InputStream {
public:
    virtual int get() = 0;
    // Java: abstract int get();
    ...
};
class SeekableInputStream : public InputStream {
public:
    virtual void seek(int offset) = 0;
    virtual int tell() = 0;
};
class FileInputStream : public SeekableInputStream {
public:
    virtual int get();
    virtual void seek(int offset);
    virtual int tell();
    ...
};
```


### C++ inheritence: approx memory layout 

![](/overflow-subterfuge/texfig/inheritMemLay.figure.svg){fig-alt="Memory layouts for InputStream, SeekableInputStream, FileInputStream. All start with a vtable pointer; in the case of FileInputStream that vtable pointer is followed by `file_pointer`. Each vtable pointer points to array with slots for function. InputStream just has one slot for get; SeekableInputStream has three slots for get, seek, tell. FIleInputStream has the same slots as SeekableInputStream, but they are filled with pointers to the methods FileInputStream::get, FileInputStream::seek, FileInputStream::tell."}


### C++ implementation (pseudo-code)


```cpp
struct InputStream_vtable {
    int (*get)(InputStream* this);
};

struct InputStream {
    InputStream_vtable *vtable;
};

...

    InputStream *s = ...;
    int c = (s->vtable->get)(s);

```


### C++ implementation (pseudo-code)

 
```cpp
struct SeekableInputStream_vtable {
    struct InputStream_vtable as_InputStream;
    void (*seek)(SeekableInputStream* this, int offset);
    int (*tell)(SeekableInputStream* this);
};

struct FileInputStream {
    SeekableInputStream_vtable *vtable;
    FILE *file_pointer;
};

...

    FileInputStream file_in = { the_FileInputStream_vtable,  ... };
    InputStream *s = (InputStream*) &file_in;

```


### C++ implementation (pseudo-code)

```cpp
SeekableInputStream_vtable the_FileInputStream_vtable = {
    &FileInputStream_get,
    &FileInputStream_seek,
    &FileInputStream_tell,
};

...

    FileInputStream file_in = { the_FileInputStream_vtable,  ... };
    InputStream *s = (InputStream*) &file_in;
```

